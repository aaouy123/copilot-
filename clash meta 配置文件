mode: rule
mixed-port: 10801
allow-lan: false
log-level: info
ipv6: true
secret: ''
external-controller: 127.0.0.1:9090
find-process-mode: strict # 可选 进程模式 off/strict/always （关闭/自适应/强制开启）
unified-delay: false
tcp-concurrent: true
keep-alive-interval: 30
global-client-fingerprint: chrome

profile:
  store-selected: true
  store-fake-ip: true
  
geox-url:
  geoip: "https://github.moeyy.xyz/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://github.moeyy.xyz/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://mirror.ghproxy.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country-lite.mmdb"
  asn: "https://raw.githubusercontent.com/xishang0128/geoip/release/GeoLite2-ASN.mmdb"
geodata-mode: true
geodata-loader: memconservative # 可选 standard/memconservative 标准加载器/低内存设备优化加载器
geo-auto-update: true
geo-update-interval: 24
global-ua: clash.meta

tun:
  enable: true
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  strict-route: false
  
dns:
  enable: true
  cache-algorithm: arc # 缓存算法 lru/lfu/arc 缓存少量常用/不常用/自适应
  prefer-h3: false 
  use-hosts: true
  use-system-hosts: true
  respect-rules: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip # DNS 处理模式 normal/fake-ip/redir-host 无特别需求/虚拟IP/真实IP
  fake-ip-range: 198.18.0.1/15
  fake-ip-filter-mode: blacklist #可选 fake-ip过滤器 处理模式 blacklist/whitelist（黑名单/白名单）
  fake-ip-filter:
    - "*"
    - "+.lan"
    - "+.local"
    - "geosite:cn,private"
    # Google FCM 服务器
    - "geosite:googlefcm"
  default-nameserver:
    - 223.5.5.5
    - 120.53.53.53
  nameserver-policy:
    "geosite:googlefcm":
      - "https://223.5.5.5/dns-query"
    "geosite:cn,private":
      - "https://223.6.6.6/dns-query"
      - "https://120.53.53.53/dns-query"
    "geosite:gfw,geolocation-!cn":
      - "https://dns.cloudflare.com/dns-query"
      - "https://dns.google/dns-query"
  nameserver:
    - https://dns.cloudflare.com/dns-query
    - https://dns.google/dns-query
  proxy-server-nameserver:
    - https://223.6.6.6/dns-query
    - https://120.53.53.53/dns-query
  direct-nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  direct-nameserver-follow-policy: false
  
hosts:
  time.android.com: 203.107.6.88
  time.facebook.com: 203.107.6.88
  localhost: 127.0.0.1
      
sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    TLS:
      ports:
      - 443
      - 5228
      - 8443
    HTTP:
      ports:
      - 80
      - 8080-8880
      override-destination: true
    QUIC:
      ports:
      - 443
      - 5228
      - 8443
  force-domain:
    - "+.v2ex.com"
    # Google FCM 服务器
    - "geosite:googlefcm"
    - "google.com"
  skip-domain:
    - "Mijia Cloud"
    - "dlg.io.mi.com"
    - "+.apple.com"  
    
        
proxies:
  - {name: "dns-out", type: dns, udp: true}
        
p: &p
  {type: http, interval: 86400, health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 600, timeout: 5000, lazy:true, expected-status: 204}}  
u: &u
  use:
  # - 0.格式模板
  - 1.provider
  - 2.provider
proxy-providers:
#<<<<<<<<<<<<<<<<<
  # 0.格式模板:
  #   <<: *p  
  #   url: "http://1.1.1.1" (订阅地址-本地文件可忽略)
  #   path: ./proxy_providers/provider_subscribe3.yaml  (可灵活变更-不可冲突)
  1.provider:
    <<: *p
    url: ""
    path: ./proxy_providers/provider_subscribe1.yaml
  2.provider:
    <<: *p
    url: ""
    path: ./proxy_providers/provider_subscribe2.yaml
    #注意！如果您的订阅链接中带有“&”字符，请删掉.
    
#>>>>>>>>>>>>>>>>>
##### 代理组
proxy-groups:
  - {name: 🌟 总模式, type: select, proxies: [🚀 节点选择,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 🚀 节点选择, type: select, proxies: [🪐 自动切换,🌎 全球直连], <<: *u}
  - {name: 🪐 自动切换, <<: *u, tolerance: 2, type: url-test, filter: "(?i)^(?!.*emby).*"}
  - {name: ☀️ 手动切换1, type: select, proxies: [🚀 节点选择,🌎 全球直连], <<: *u}
  - {name: 🌙 手动切换2, type: select, proxies: [🚀 节点选择,🌎 全球直连], <<: *u}
  - {name: 🤖 AI, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 📲 Telegram, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 🍦 YouTube, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 🍿 Netflix, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 🧋 Bilibili, type: select, proxies: [🌟 总模式,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾]}
  - {name: 🍨 EMBY, type: select, proxies: [🌟 总模式,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇺🇳 其它地区], <<: *u, filter: "(?i)emby|plex|media"}
  - {name: 📸 TikTok, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: ✈️ Twitter, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 📢 Google, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: Ⓜ️ Microsoft, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 🍎 Apple, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 🎮 Discord, type: select, proxies: [🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🌎 全球直连,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - {name: 🧭 Virtual Location, type: select, proxies: [🌎 全球直连,🌟 总模式,🪐 自动切换,☀️ 手动切换1,🌙 手动切换2,🇭🇰 香港,🇨🇳 台湾,🇯🇵 日本,🇸🇬 新加坡,🇺🇸 美国,🇺🇳 其它地区]}
  - { name: 📟 WebRTC, type: select, proxies: [ REJECT, REJECT-DROP, PASS ]}
  - {name: 🛑 隐私拦截, type: select, proxies: [REJECT,REJECT-DROP,PASS,🌟 总模式,🌎 全球直连]}
  - {name: 🐋 漏网之鱼, type: select, proxies: [🌟 总模式,🌎 全球直连]}
  - {name: 🌎 全球直连, type: select, proxies: [DIRECT]}
  
  # 分隔，下面是地区分组
  - {name: 🇭🇰 香港, type: select, proxies: [香港延时选优组, 香港故障转移组]}
  - {name: 🇨🇳 台湾, type: select, proxies: [台湾延时选优组, 台湾故障转移组]}
  - {name: 🇯🇵 日本, type: select, proxies: [日本延时选优组, 日本故障转移组]}
  - {name: 🇸🇬 新加坡, type: select, proxies: [新加坡延时选优组, 新加坡故障转移组]}
  - {name: 🇺🇸 美国, type: select, proxies: [美国延时选优组, 美国故障转移组]}
  - {name: 🇺🇳 其它地区, type: select, include-all-providers: true, filter: "(?i)^(?!.*(?:🇭🇰|🇯🇵|🇺🇸|🇸🇬|🇨🇳|港|hk|hongkong|台|tw|taiwan|日|jp|japan|新|sg|singapore|美|us|unitedstates|emby)).*|.*(?:澳大利亚|australia)"}
     
  # 隐藏 延时选优组
  - {name: 香港延时选优组, type: url-test, include-all-providers: true, interval: 600, tolerance: 5, lazy: true, hidden: true, filter: "(?i)(?=.*(?:港|hk|hongkong|hong\\s+kong))(?!.*(?:emby.*hk|hk.*emby))"}
  - {name: 台湾延时选优组, type: url-test, include-all-providers: true, interval: 600, tolerance: 5, lazy: true, hidden: true, filter: "(?i)台|tw|taiwan"}
  - {name: 日本延时选优组, type: url-test, include-all-providers: true, interval: 600, tolerance: 5, lazy: true, hidden: true, filter: "(?i)日|jp|japan"}
  - {name: 新加坡延时选优组, type: url-test, include-all-providers: true, interval: 600, tolerance: 5, lazy: true, hidden: true, filter: "(?i)(新|sg|singapore)"}
  - {name: 美国延时选优组, type: url-test, include-all-providers: true, interval: 600, tolerance: 5, lazy: true, hidden: true, filter: "(?i)(?=.*(?:美|\\bus\\b|united\\s*states))(?!.*(?:澳大利亚|australia))"}
    
  # 隐藏 故障转移组
  - {name: 香港故障转移组, type: fallback, include-all-providers: true, interval: 600, tolerance: 5, timeout: 2000, lazy: true, hidden: true, filter: "(?i)(?=.*(?:港|hk|hongkong|hong\\s+kong))(?!.*(?:emby.*hk|hk.*emby))"}
  - {name: 台湾故障转移组, type: fallback, include-all-providers: true, interval: 600, tolerance: 5, timeout: 2000, lazy: true, hidden: true, filter: "(?i)台|tw|taiwan"}
  - {name: 日本故障转移组, type: fallback, include-all-providers: true, interval: 600, tolerance: 5, timeout: 2000, lazy: true, hidden: true, filter: "(?i)日|jp|japan"}
  - {name: 新加坡故障转移组, type: fallback, include-all-providers: true, interval: 600, tolerance: 5, timeout: 2000, lazy: true, hidden: true, filter: "(?i)(新|sg|singapore)"}
  - {name: 美国故障转移组, type: fallback, include-all-providers: true, interval: 600, tolerance: 5, timeout: 2000, lazy: true, hidden: true, filter: "(?i)(?=.*(?:美|\\bus\\b|united\\s*states))(?!.*(?:澳大利亚|australia))"}
  
rule-providers-anchor: 
  rule_domain: &rule_domain {type: http, interval: 86400, behavior: domain}
  rule_ipcidr: &rule_ipcidr {type: http, interval: 86400, behavior: ipcidr}
  rule_classical: &rule_classical {type: http, interval: 86400, behavior: classical}
     
rule-providers:
  Telegram:
    <<: *rule_classical
    format: yaml
    path: ./rule/Telegram.yaml
    url: "https://raw.githubusercontent.com/MoGuangYu/rules/main/Home/Telegram.yaml"
  Youtube:
    <<: *rule_classical
    format: yaml
    path: ./rule/Youtube.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
  Google:
    <<: *rule_classical
    format: yaml
    path: ./rule/Google.yaml
    url: "https://raw.githubusercontent.com/MoGuangYu/rules/main/Home/Google.yaml"
  Microsoft:
    <<: *rule_classical
    format: yaml
    path: ./rule/Microsoft.yaml
    url: "https://raw.githubusercontent.com/MoGuangYu/rules/main/Home/Microsoft.yaml"
  Apple:
    <<: *rule_classical
    format: yaml
    path: ./rule/Apple.yaml
    url: "https://raw.githubusercontent.com/MoGuangYu/rules/main/Home/Apple.yaml"
  Netflix:
    <<: *rule_classical
    format: yaml
    path: ./rule/Netflix.yaml
    url: "https://raw.githubusercontent.com/MoGuangYu/rules/main/Home/Netflix.yaml"
  Discord:
    <<: *rule_classical
    format: yaml
    path: ./rule/Discord.yaml
    url: "https://raw.githubusercontent.com/MoGuangYu/rules/main/Home/Discord.yaml"
  BiliBili:
    <<: *rule_classical
    format: yaml
    path: ./rule/BiliBili.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/BiliBili/BiliBili.yaml"
  EMBY:
    <<: *rule_classical
    format: yaml
    path: ./rule/EMBY.yaml
    url: "https://raw.githubusercontent.com/aaouy123/copilot-/main/emby.yaml"
  TikTok:
    <<: *rule_classical
    format: yaml
    path: ./rule/TikTok.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok.yaml"
  AI:
    <<: *rule_classical
    format: yaml
    path: ./rule/AI.yaml
    url: "https://raw.githubusercontent.com/aaouy123/copilot-/refs/heads/main/AI%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%A7%84%E5%88%99%E9%9B%86.yaml"
  De-advertising_rules:
    <<: *rule_domain
    format: text
    url: "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/domains/light.txt"
    path: ./rule_providers/De-advertising_rules.yaml 
  Lan:
    <<: *rule_classical
    format: yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml"
    path: ./rule/Lan.yaml
  site_category-httpdns:
    <<: *rule_domain
    format: mrs
    path: ./rule_providers/domain/category-httpdns
    url: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/httpdns.mrs"
  site_category-httpdns-cn:
    <<: *rule_domain
    format: mrs
    path: ./rule_providers/domain/category-httpdns-cn
    url: 'https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/category-httpdns-cn.mrs'
  site_virtual-location: 
    <<: *rule_domain
    format: mrs
    path: ./rule_providers/domain/virtual-location
    url: "https://raw.githubusercontent.com/aaouy123/copilot-/main/virtual-location.mrs"
              
rules:
  - AND,((PROCESS-NAME,mihomo),(NOT,((IN-TYPE,inner)))),REJECT
  - AND,((PROCESS-NAME,clash),(NOT,((IN-TYPE,inner)))),REJECT
  - DST-PORT,53,dns-out  
  - RULE-SET,Lan,DIRECT
  - OR,((GEOSITE,private),(GEOIP,private,no-resolve)),DIRECT
  - OR,((RULE-SET,site_category-httpdns),(RULE-SET,site_category-httpdns-cn),(DOMAIN-KEYWORD,httpdns)),REJECT-DROP
  - AND,((GEOSITE,googlefcm),(DST-PORT,5228-5230)),DIRECT 
  - RULE-SET,De-advertising_rules,🛑 隐私拦截
  - AND,((NETWORK,udp),(DOMAIN-REGEX,(?i)stun|turn)),📟 WebRTC # 是否禁用 stun/turn 协议的 udp 数据, 禁用后可以有效解决 webrtc 的 ip 泄露
  - RULE-SET,Telegram,📲 Telegram
  - DOMAIN,api.iturrit.com,📲 Telegram
  - RULE-SET,AI,🤖 AI
  - RULE-SET,Youtube,🍦 YouTube
  - RULE-SET,Netflix,🍿 Netflix
  - RULE-SET,Discord,🎮 Discord
  - RULE-SET,site_virtual-location,🧭 Virtual Location # 抖音快手小红书位置 可能无效
  - RULE-SET,BiliBili,🧋 Bilibili
  - RULE-SET,EMBY,🍨 EMBY
  - RULE-SET,TikTok,📸 TikTok
  - GEOSITE,twitter,✈️ Twitter
  - GEOIP,twitter,✈️ Twitter
  - RULE-SET,Google,📢 Google
  - RULE-SET,Apple,🍎 Apple
  - RULE-SET,Microsoft,Ⓜ️ Microsoft
  - OR,((GEOSITE,gfw),(GEOSITE,geolocation-!cn)),🐋 漏网之鱼
  - GEOSITE,CN,DIRECT
  - GEOIP,CN,DIRECT,no-resolve
  - MATCH,🐋 漏网之鱼
